<!DOCTYPE html>
<html lang="en">

	<head>

		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<meta name="description" content="">
		<meta name="author" content="">

		<title>It's a bit of Max</title>

		<!-- Bootstrap core CSS -->
		<link href="../vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

		<!-- Custom fonts for this template -->
		<link href="../vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
		<link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
		<link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

		<!-- jQuery CDN -->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

		<!-- Custom styles for this template -->
		<link href="../css/clean-blog.min.css" rel="stylesheet">

	</head>
	<style type="text/css">
		kbd {
		  color: #FFF;
		  background-color: lightblue;
		}
	</style>

	<body>

		<!--Navigation bar-->
		<div id="nav-placeholder"></div>

		<!-- Page Header -->
		<header class="masthead" style="background-image: url('./default.jpg')">
			<div class="overlay"></div>
			<div class="container">
				<div class="row">
					<div class="col-lg-8 col-md-10 mx-auto">
						<div class="post-heading">
							<h1 id="title">My first blog post</h1>
							<h2 class="subheading" id="subheading">And it is finally here...</h2>
							<span class="meta">Posted by
								<a href="#">Max</a>
								on May 31st, 2019</span>
							<kbd id="tag"><a href="javascript:on_tag_post('Life')">Life</a></kbd>
						</div>
					</div>
				</div>
			</div>
		</header>

		<!-- Post Content -->
		<article>
			<div class="container">
				<div class="row">
					<div class="col-lg-8 col-md-10 mx-auto">
						<p>A while ago, Alice and I thought we should create our own websites. And now it finally is now here.</p>

						<p>Initially, Alice took over the job because she needed it more than I did. She has experimented many things, and she created this awesome website layout. But, I was too busy (actually lazy) to fork her repo and create my own, until a week ago...</p>

						<p>What was leftover was the functionality for automatically blog pagination, grouping by category and searching. I managed to finish all of them, in JavaScript. The blog-post.js file contains 90% of the logic that I wrote.</p>

						<h2 class="section-heading">Automatic pagination and Blog loading</h2>

						<p>The pagination is done by first looking for all files inside the <code>posts</code> folder. Then based on the predefined maximum blogs per page, it calculates the neceassray number of pages. It also highlights the current page, and based on it to disable/enable <code>Newer</code> and <code>Older</code> buttons</p>

						<pre><code> function setup_pagination(){
	$("#paginator").html('&ltdiv id="paginator-placeholder">&lt/div>');
	// disable newer when no more newer blogs
	if (currPage == 1){
		$("#paginator-placeholder").before('&ltli class="page-item disabled" id="newer_button">&lta class="page-link" href="javascript:on_newer_blog()">&larr; Newer&lt/a>&lt/li>');
	}
	else{
		$("#paginator-placeholder").before('&ltli class="page-item" id="newer_button">&lta class="page-link" href="javascript:on_newer_blog()">&larr; Newer&lt/a>&lt/li>');
	}

	// page number
	for (i = 1; i<= numPage; i++){
		// make current page active
		if (currPage == i){
			$("#paginator-placeholder").before('&ltli class="page-item active">&lta class="page-link" href="javascript:on_page_number('+i+')">'+i+'&lt/a>&lt/li>');
		}
		else{
			$("#paginator-placeholder").before('&ltli class="page-item">&lta class="page-link" href="javascript:on_page_number('+i+')">'+i+'&lt/a>&lt/li>');
		}

	}

	// disable older when no more older blogs
	if (currPage == numPage){
		$("#paginator-placeholder").before('&ltli class="page-item disabled" id="older_button">&lta class="page-link" href="javascript:on_older_blog()">Older &rarr;&lt/a>&lt/li>');
	}
	else{
		$("#paginator-placeholder").before('&ltli class="page-item" id="older_button">&lta class="page-link" href="javascript:on_older_blog()">Older &rarr; &lt/a>&lt/li>');
	}
}</code></pre>

						<p>Afterwards, the files are parsed into html content.</p>
						<pre><code>function parse_html(file,index){
	// initialize the reader
	var xhr = new XMLHttpRequest();

	// add event listener
	xhr.addEventListener("load", function() {
		load_card(xhr.response,file,index); // callback to load_card
	}, false);

	// open file and send event
	xhr.open('GET', file);
	xhr.send();
}</code></pre>
						<p>The callback will then load the content properly as <i>cards</i>.</p>
						<pre><code>function load_card(content,file,i) {
	// read content as html
	parser = new DOMParser();
	htmlDoc = parser.parseFromString(content,"text/html");

	if (mode == MODE.INDEX || (mode == MODE.TAG && htmlDoc.getElementById("tag").childNodes[0].innerText == keyword) || (mode == MODE.SEARCH && htmlDoc.body.textContent.match(RegExp(keyword,"gi"))) ){ // we are in index page or keyword matches, show
		if (error){ // clear error message
			error = false;
			document.getElementById('card-list-placeholder').innerText = '';
		}
		var image = file.replace("html","jpg");
		var date = file.slice(8,18);
		date = date.split("_");

		// add card object to card list
		document.getElementById('card-list-placeholder').innerHTML += '&ltdiv class="card mb-4" id="post_'+i.toString()+'">&lt/div>';
		// add image
		document.getElementById('post_'+i.toString()).innerHTML += '&ltimg class="card-img-top" src="'+image+'" alt="Card image cap"/>';
		// add title
		document.getElementById('post_'+i.toString()).innerHTML += '&ltdiv class="card-body">'+'&lth2 class="card-title" align-items-center>'+htmlDoc.getElementById("title").childNodes[0].nodeValue+'&lt/h2>';
		// add hyperlink
		document.getElementById('post_'+i.toString()).innerHTML += '&lta href="'+file+'" class="btn btn-primary">Read More &rarr;&lt/a>'+'&lt/div>';
		// add date and tag
		var tagString = "'"+htmlDoc.getElementById("tag").childNodes[0].innerText+"'"
		document.getElementById('post_'+i.toString()).innerHTML += '&ltdiv class="card-footer text-muted">Posted on '+month.get(date[1])+" "+date[2]+", "+date[0]+'  &ltkbd id="tag">&lta href="javascript:on_tag('+tagString+')">'+htmlDoc.getElementById("tag").childNodes[0].innerText+'&lt/a>&lt/kbd>';

		// in case an image doesnt exist, use default
		$(".card-img-top").on("error", function(){
	        $(this).attr('src', './posts/default.jpg');
	    });
	}
	else{
		if (error){ // show error message
			document.getElementById('card-list-placeholder').innerText = 'There is no blog :(';
		}
	}
}
						</code></pre>

						<h2 class="section-heading">Grouping by category and Searching</h2>

						<p>These functions are achieved by redirecting the page to the home page with additional parameters passed as TAG and KEYWORD. Therefore, there are three modes for the home page:
							<ul>
								<li>default mode</li>
								<li>tag mode</li>
								<li>searching mode</li>
							</ul>
						</p>
						<pre><code>window.on_tag = function(tag){
	window.location.href = "./index.html?tag="+tag;
}

window.on_search = function(keyword){
	window.location.href = "./index.html?keyword="+keyword;
}</code></pre>

				<br>
				<p>That is all for now. I will try to write another one about the history of surgical robots soon.</p>
				</div>
			</div>
		</article>

		<hr>

		<!--Footer-->
		<div id="footer-placeholder"></div>

		<!-- Header and footer scripts -->
		<script>
			$(function(){
				$("#nav-placeholder").load("../nav-post.html");
			});
		</script>

		<script>
			$(function(){
				$("#footer-placeholder").load("../footer.html");
			});
		</script>

		<!-- Bootstrap core JavaScript -->
		<script src="../vendor/jquery/jquery.min.js"></script>
		<script src="../vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

		<!-- Custom scripts for this template -->
		<script src="../js/clean-blog.min.js"></script>

		<!-- tag -->
		<script src="../js/blog-bundle.min.js"></script>

	</body>

</html>
